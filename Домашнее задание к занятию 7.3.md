# Домашнее задание к занятию "7.3. Основы и принцип работы Терраформ"

## Задача 1. Создадим бэкэнд в S3 (необязательно, но крайне желательно).

<details>
    <summary> Задание </summary>	
	
	Если в рамках предыдущего задания у вас уже есть аккаунт AWS, то давайте продолжим знакомство со взаимодействием терраформа и aws.

    Создайте s3 бакет, iam роль и пользователя от которого будет работать терраформ. Можно создать отдельного пользователя, а можно использовать созданного в рамках предыдущего задания, просто добавьте ему необходимы права, как описано здесь.
    Зарегистрируйте бэкэнд в терраформ проекте как описано по ссылке выше.
	
</details>
	
### Будет ли достаточно, для первого пункта, создания бакета ? tf файл ниже и прикреплен.

<details>
    <summary>main.tf</summary>		
	
provider "yandex" {
  token     = "keykeykeykeykeykeykeykeykey"
  cloud_id  = "b1g1q5rskild90n5b9n4"
  folder_id = "b1gq945akrsqbn63337t"
  zone      = "ru-central1-a"
}


resource "yandex_storage_bucket" vagatestdz73 {
  access_key = "keykeykeykeykeykey"
  secret_key = "keykeykeykeykeykey"
  bucket = "bucketdz7-3"
}
  
resource yandex_compute_image "ubuntu" {
  name          = "ubuntu-2004-lts"
  source_image  = "fd8qs44945ddtla09hnr"
} 
  
resource "yandex_vpc_network" "net" {
  name = "networkdz72"
}

resource "yandex_vpc_subnet" "subnet" {
  name           = "subnet"
  network_id     = resource.yandex_vpc_network.net.id
  v4_cidr_blocks = ["10.2.0.0/16"]
  zone           = "ru-central1-a"
}

resource "yandex_compute_instance" "vm" {
  name        = "netologydz72"
  hostname    = "netologydz72.local"
  platform_id = "standard-v1"

resources {
    cores         = 2
    memory        = 2
    core_fraction = 100
  }

  boot_disk {
    initialize_params {
      image_id = resource.yandex_compute_image.ubuntu.id
      type     = "network-hdd"
      size     = "20"
    }
  }

  network_interface {
    subnet_id = yandex_vpc_subnet.subnet.id
    nat       = true
    ipv6      = false
  }

  metadata = {
    ssh-keys = "ubuntu:${file("~/.ssh/id_rsa.pub")}"
  }
}
</details>

## Задача 2. Инициализируем проект и создаем воркспейсы.

### Будет ли выполнение  для Яндекса отличаться от AWS?  Если да, то в чем?

<details>
    <summary> Задание </summary>	
	
    Выполните terraform init:
        если был создан бэкэнд в S3, то терраформ создат файл стейтов в S3 и запись в таблице dynamodb.
        иначе будет создан локальный файл со стейтами.
    Создайте два воркспейса stage и prod.
    В уже созданный aws_instance добавьте зависимость типа инстанса от вокспейса, что бы в разных ворскспейсах использовались разные instance_type.
    Добавим count. Для stage должен создаться один экземпляр ec2, а для prod два.
    Создайте рядом еще один aws_instance, но теперь определите их количество при помощи for_each, а не count.
    Что бы при изменении типа инстанса не возникло ситуации, когда не будет ни одного инстанса добавьте параметр жизненного цикла create_before_destroy = true в один из рессурсов aws_instance.
    При желании поэкспериментируйте с другими параметрами и рессурсами.

В виде результата работы пришлите:

    Вывод команды terraform workspace list.
    Вывод команды terraform plan для воркспейса prod.
	
</details>